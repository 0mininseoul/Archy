import { formatKSTDate } from "./utils";

// Universal Prompt - 할루시네이션 방지 및 유연한 문서 구성
const UNIVERSAL_PROMPT = `당신은 전문 에디터이자 콘텐츠 요약 전문가입니다.
아래에 제공된 녹취록을 분석하여 핵심 내용을 파악하고, 읽기 쉬운 마크다운 문서로 정리해주세요.

## 녹취록 (이것이 정리해야 할 내용입니다)
{{transcript}}

## ⚠️ 절대 금지 사항
1. **녹취록에 없는 내용은 절대 추가하거나 추측하지 마세요.**
2. **"녹취록을 제공해주세요", "내용을 입력해주세요" 등 입력을 요청하는 응답을 하지 마세요.** 위에 녹취록이 이미 제공되어 있습니다.
3. 녹취록이 불완전하거나 내용이 부족해도:
   - 있는 내용만 간결하게 정리하세요
   - 억지로 내용을 채우거나 만들어내지 마세요
4. 불명확한 부분은 "[불명확]" 또는 "..." 으로 표시하세요
5. 녹취록에 언급되지 않은 세부사항을 창작하지 마세요

## 필수 요구사항
다음 규칙을 엄격히 준수하세요:

1. **제목**: 녹취록의 주제/맥락을 요약한 제목을 작성하세요. (녹취록 첫 문장을 그대로 복사하지 마세요)
2. **3줄 핵심 요약**: 제목 바로 아래에, 전체 내용을 관통하는 **가장 중요한 3가지 핵심 내용**을 요약해서 적어주세요. 이 부분은 반드시 있어야 합니다.
3. **유연한 본문 구성**: 3줄 요약 이후의 내용은 녹취록의 성격에 따라 자유롭게 구성하되, **반드시 소제목(##, ###)을 사용하여 구조화**해주세요. 줄글로만 길게 늘어놓지 마세요.
   - **회의라면**: ## 안건, ## 결정 사항, ## 액션 아이템 등으로 섹션 구분.
   - **강의라면**: ## 학습 목표, ## 주요 개념, ## 핵심 요점 등으로 섹션 구분.
   - **단순 대화라면**: ## 주요 대화 흐름, ## 결론 등으로 섹션 구분.
   - **짧은 메모나 독백이라면**: 핵심 요약만으로 충분합니다. 억지로 섹션을 만들지 마세요.
   - 녹취록의 전체적인 맥락을 파악하여 가장 적합한 구조를 직접 결정하세요.

## 출력 형식
반드시 아래 형식을 지켜주세요. 괄호 안의 설명은 실제 내용으로 대체해야 합니다:

[TITLE]
녹취록 내용을 요약한 실제 제목
[/TITLE]
[CONTENT]
### 📌 3줄 핵심 요약
- 첫 번째 핵심 내용
- 두 번째 핵심 내용
- 세 번째 핵심 내용

이후 본문 내용을 마크다운으로 작성 (적절한 이모지 사용 권장)
[/CONTENT]

⚠️ 주의:
- "(제목)", "(핵심 1)" 같은 플레이스홀더를 그대로 출력하지 마세요.
- "녹취록을 제공해주세요", "내용을 입력해주세요" 같은 입력 요청 문구를 절대 출력하지 마세요.
- 반드시 위에 제공된 녹취록을 기반으로 실제 내용을 작성하세요.`;

export function buildUniversalPrompt(transcript: string): string {
  const date = formatKSTDate();
  return UNIVERSAL_PROMPT
    .replace("{{transcript}}", transcript)
    .replace("{{date}}", date);
}
